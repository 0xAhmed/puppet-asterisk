class asterisk {
	class install {
			case $operatingsystem {
				"CentOS" : {
					case $architecture {
						"i386" : {
						# Install asterisk dependcies
						$asterisk_packages_32 = []
						package { $asterisk_packges_32: ensure => installed }
						
						# Create /usr/src/asterisk dir to hold asterisk sources
						file { "/usr/src/asterisk" :
							ensure => directory,
							owner => root,
							group => root,
							mode => 644
						}

						# Download and untar asterisk sources
						exec { "wget http://downloads.digium.com/pub/asterisk/asterisk-1.4-current.tar.gz" :
							cwd => "/usr/src/asterisk",
							creates => "/usr/src/asterisk/asterisk-1.4-current.tar.gz",
							path => "/usr/bin:/usr/sbin:/bin"
						}
						exec { "tar -zxf asterisk-1.4-current.tar.gz" :
							cwd => "/usr/src/asterisk",
							require => File["/usr/src/asterisk/asterisk-1.4-current.tar.gz"],
							path => "/usr/bin:/usr/sbin:/bin"
						}

            # Download and untar asterisk sources
            exec { "wget http://downloads.digium.com/pub/telephony/dahdi-linux-complete/dahdi-linux-complete-current.tar.gz" :
              cwd => "/usr/src/asterisk",
              creates => "/usr/src/asterisk/dahdi-linux-complete-current.tar.gz",
							path => "/usr/bin:/usr/sbin:/bin"
            }
            exec { "tar -zxf dahdi-linux-complete-current.tar.gz" :
              cwd => "/usr/src/asterisk",
              require => File["/usr/src/asterisk/dahdi-linux-complete-current.tar.gz"],
							path => "/usr/bin:/usr/sbin:/bin"
            }

            # Download and untar libpri sources
            exec { "wget http://downloads.digium.com/pub/libpri/libpri-1.4-current.tar.gz" :
              cwd => "/usr/src/asterisk",
              creates => "/usr/src/asterisk/libpri-1.4-current.tar.gz",
							path => "/usr/bin:/usr/sbin:/bin"
						}
            exec { "tar -zxf libpri-1.4-current.tar.gz" :
              cwd => "/usr/src/asterisk",
              require => File["/usr/src/asterisk/libpri-1.4-current.tar.gz"],
							path => "/usr/bin:/usr/sbin:/bin"
            }

            # Download and untar spandsp sources
            exec { "wget http://soft-switch.org/downloads/spandsp/spandsp-0.0.5.tgz" :
              cwd => "/usr/src/asterisk",
              creates => "/usr/src/asterisk/spandsp-0.0.5.tgz",
							path => "/usr/bin:/usr/sbin:/bin"
            }
            exec { "tar -zxf spandsp-0.0.5.tgz" :
              cwd => "/usr/src/asterisk",
              require => File["/usr/src/asterisk/spandsp-0.0.5.tgz"],
							path => "/usr/bin:/usr/sbin:/bin"
            }


												
						}
						"x86_64" : {

						}
					}
				}
			}


}
}
node "server1.example.com" {
	include asterisk::install
}

